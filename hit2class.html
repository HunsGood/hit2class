<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìºë¦­í„° ê´€ë¦¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 30px;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .controls {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status {
            font-size: 14px;
            color: #666;
        }

        .status.connected {
            color: #4CAF50;
        }

        .status.error {
            color: #f44336;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-add {
            background: #4CAF50;
            color: white;
        }

        .btn-add:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-add:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        th:hover {
            background: linear-gradient(135deg, #5568d3 0%, #653a8b 100%);
        }

        th.sortable::after {
            content: ' â‡…';
            opacity: 0.3;
            font-size: 12px;
        }

        th.sort-asc::after {
            content: ' â–²';
            opacity: 1;
        }

        th.sort-desc::after {
            content: ' â–¼';
            opacity: 1;
        }

        tr:hover {
            background: #f5f5f5;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-edit, .btn-delete, .btn-save, .btn-cancel {
            padding: 6px 12px;
            margin: 0 3px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #2196F3;
            color: white;
        }

        .btn-edit:hover {
            background: #0b7dda;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-delete:hover {
            background: #da190b;
        }

        .btn-save {
            background: #4CAF50;
            color: white;
        }

        .btn-save:hover {
            background: #45a049;
        }

        .btn-cancel {
            background: #9E9E9E;
            color: white;
        }

        .btn-cancel:hover {
            background: #757575;
        }

        .actions {
            white-space: nowrap;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            th, td {
                padding: 10px 5px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® ìºë¦­í„° ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
        
        <div class="controls">
            <button class="btn btn-add" onclick="addRow()" id="addBtn">â• ìƒˆ ìºë¦­í„° ì¶”ê°€</button>
            <div class="status" id="statusMsg">ì—°ê²° ì¤‘...</div>
        </div>

        <table id="characterTable">
            <thead>
                <tr>
                    <th onclick="sortTable('id')" class="sortable">ID</th>
                    <th onclick="sortTable('name')" class="sortable">Name</th>
                    <th onclick="sortTable('lv')" class="sortable">LV</th>
                    <th onclick="sortTable('skill')" class="sortable">Skill</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr>
                    <td colspan="5" class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // âš ï¸ ì—¬ê¸°ì— ë°°í¬í•œ Worker URLì„ ì…ë ¥í•˜ì„¸ìš”
        const API_URL = 'https://character-api.hproject13579.workers.dev';
        
        let data = [];
        let isLoading = false;
        let sortColumn = 'id';
        let sortDirection = 'asc';

        // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        function updateStatus(message, type = 'normal') {
            const statusEl = document.getElementById('statusMsg');
            statusEl.textContent = message;
            statusEl.className = 'status';
            if (type === 'connected') statusEl.classList.add('connected');
            if (type === 'error') statusEl.classList.add('error');
        }

        // ë°ì´í„° ë¡œë“œ
        async function loadData() {
            isLoading = true;
            document.getElementById('addBtn').disabled = true;
            
            try {
                const response = await fetch(`${API_URL}/api/characters`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                data = await response.json();
                updateStatus(`âœ“ DB ì—°ê²°ë¨ (${data.length}ê°œ í•­ëª©)`, 'connected');
                sortTable(sortColumn); // ì´ˆê¸° ì •ë ¬ ì ìš©
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                updateStatus('âŒ DB ì—°ê²° ì‹¤íŒ¨ - Worker URLì„ í™•ì¸í•˜ì„¸ìš”', 'error');
                document.getElementById('tableBody').innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align:center; color:#f44336; padding:40px;">
                            <strong>ì—°ê²° ì˜¤ë¥˜</strong><br><br>
                            Worker URLì„ í™•ì¸í•˜ì„¸ìš”: <code>${API_URL}</code><br>
                            ì—ëŸ¬: ${error.message}
                        </td>
                    </tr>
                `;
            } finally {
                isLoading = false;
                document.getElementById('addBtn').disabled = false;
            }
        }

        // í…Œì´ë¸” ì •ë ¬
        function sortTable(column) {
            // ê°™ì€ ì»¬ëŸ¼ í´ë¦­ ì‹œ ë°©í–¥ ì „í™˜
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }

            // ë°ì´í„° ì •ë ¬
            data.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];

                // ìˆ«ì íƒ€ì… ì²˜ë¦¬
                if (column === 'lv' || column === 'id') {
                    aVal = Number(aVal);
                    bVal = Number(bVal);
                }
                // ë¬¸ìì—´ íƒ€ì… ì²˜ë¦¬
                else {
                    aVal = String(aVal).toLowerCase();
                    bVal = String(bVal).toLowerCase();
                }

                if (sortDirection === 'asc') {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });

            updateSortIndicators();
            renderTable();
        }

        // ì •ë ¬ ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸
        function updateSortIndicators() {
            // ëª¨ë“  í—¤ë” ì´ˆê¸°í™”
            document.querySelectorAll('th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });

            // í˜„ì¬ ì •ë ¬ ì»¬ëŸ¼ì— í´ë˜ìŠ¤ ì¶”ê°€
            const headers = document.querySelectorAll('th');
            const columnIndex = ['id', 'name', 'lv', 'skill'].indexOf(sortColumn);
            if (columnIndex >= 0) {
                headers[columnIndex].classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
            }
        }

        // í…Œì´ë¸” ë Œë”ë§
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:40px;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            tbody.innerHTML = '';

            data.forEach((item, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${item.id}</td>
                    <td><span class="view-mode">${item.name}</span><input type="text" class="edit-mode" style="display:none" value="${item.name}"></td>
                    <td><span class="view-mode">${item.lv}</span><input type="number" class="edit-mode" style="display:none" value="${item.lv}"></td>
                    <td><span class="view-mode">${item.skill}</span><input type="text" class="edit-mode" style="display:none" value="${item.skill}"></td>
                    <td class="actions">
                        <button class="btn-edit view-mode" onclick="editRow(${index})">ìˆ˜ì •</button>
                        <button class="btn-delete view-mode" onclick="deleteRow(${index})">ì‚­ì œ</button>
                        <button class="btn-save edit-mode" style="display:none" onclick="saveRow(${index})">ì €ì¥</button>
                        <button class="btn-cancel edit-mode" style="display:none" onclick="cancelEdit(${index})">ì·¨ì†Œ</button>
                    </td>
                `;
            });
        }

        // ìƒˆ í–‰ ì¶”ê°€
        async function addRow() {
            const name = prompt('ìºë¦­í„° ì´ë¦„:');
            if (!name) return;
            
            const lv = parseInt(prompt('ë ˆë²¨:', '1'));
            if (isNaN(lv)) return;
            
            const skill = prompt('ìŠ¤í‚¬:');
            if (!skill) return;

            try {
                const response = await fetch(`${API_URL}/api/characters`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, lv, skill })
                });

                if (!response.ok) throw new Error('ì¶”ê°€ ì‹¤íŒ¨');

                await loadData();
                updateStatus('âœ“ ìºë¦­í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'connected');
            } catch (error) {
                alert('ìºë¦­í„° ì¶”ê°€ ì‹¤íŒ¨: ' + error.message);
            }
        }

        // í–‰ ìˆ˜ì • ëª¨ë“œ
        function editRow(index) {
            const rows = document.querySelectorAll('#tableBody tr');
            const row = rows[index];
            
            row.querySelectorAll('.view-mode').forEach(el => el.style.display = 'none');
            row.querySelectorAll('.edit-mode').forEach(el => el.style.display = 'inline-block');
        }

        // í–‰ ì €ì¥
        async function saveRow(index) {
            const rows = document.querySelectorAll('#tableBody tr');
            const row = rows[index];
            const inputs = row.querySelectorAll('input');
            const item = data[index];
            
            const updatedData = {
                name: inputs[0].value,
                lv: parseInt(inputs[1].value),
                skill: inputs[2].value
            };

            try {
                const response = await fetch(`${API_URL}/api/characters/${item.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData)
                });

                if (!response.ok) throw new Error('ìˆ˜ì • ì‹¤íŒ¨');

                await loadData();
                updateStatus('âœ“ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤', 'connected');
            } catch (error) {
                alert('ìˆ˜ì • ì‹¤íŒ¨: ' + error.message);
                renderTable();
            }
        }

        // ìˆ˜ì • ì·¨ì†Œ
        function cancelEdit(index) {
            renderTable();
        }

        // í–‰ ì‚­ì œ
        async function deleteRow(index) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const item = data[index];

            try {
                const response = await fetch(`${API_URL}/api/characters/${item.id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('ì‚­ì œ ì‹¤íŒ¨');

                await loadData();
                updateStatus('âœ“ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'connected');
            } catch (error) {
                alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        loadData();
    </script>
</body>
</html>